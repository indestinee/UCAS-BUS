<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <title> Bus Ticket </title>
  </head>

  <body>
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
    <nav class="navbar navbar-default">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <a class="navbar-brand" href="#">Bus Ticket</a>
        <a class='navbar-brand' href="/undo">Undo</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="/refresh">Refresh<span class="sr-only">(current)</span></a></li>
            <li><a href="/restart">Restart</a></li>
            <!-- <li><a href="/undo">undo</a></li> -->
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class='active'><a href="/logout">Log Out</a></li>
            <li><a href="/logout_all">Log Out All</a></li>
          </ul>
        </div><!-- /.navbar-collapse -->
      </div><!-- /.container-fluid -->
    </nav>
    

    <div class="container">
      {% if status == 0 %}
      <div class="alert alert-info" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span></button>
        <p align=center> Hi, <strong>{{username}}</strong>! You have <strong>{{cnt}}</strong> account(s) online. </p>
      </div>
      {% endif %}
      <div class="jumbotron">
        {% if current %}
          <div class="row">
            <h3 align="center"><strong> {{current}}</strong>
          </div>
        {% endif %}
        <div class='row'>
        <hr>
        {% if status == 0 %}
          <form class="form-inline" action="" method="post" align="center">
            <div class="form-group">
              <a href='/'><img src="{{ url_for('static', filename=certcode_path)}}"></a> 
              <div class="form-group">
                <input type="text" class="form-control" placeholder="cert code" name="certcode">
              </div>
            </div>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>

        {% elif status == 1 %}
          <form action="" method="post" id="date" align='center'>
            {% for date in dates %}
            <div class="radio">
              <label>
                <input type="radio" name="date" id="date" value="{{'%s|%s'%(date[0],date[1])}}" {{date[2]}}>{{date[1]}}
              </label>
            </div>          
            {% endfor %}
            <div class="checkbox">
              <label>
                <input type="checkbox" checked name='cache'> cache first (speed up)
              </label>
            </div>

            <hr>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        {% elif status == 2 %}
          <form action="" method="post" id="route" align='center'>
            {% for route in route_list %}
            <div class="radio">
              <label>
                <input type="radio" name="route" id="route" value="{{'%s|%s'%(route[0], route[1])}}" {{route[2]}}>{{route[1]}}
              </label>
            </div>
            {% endfor %}
            <hr>
            <button type="submit" class="btn btn-default" {% if route_list[0][-1] == 'disabled' %} disabled {% endif %}>Submit</button>
          </form>
        {% elif status == 3 %}
          <form action="" method="post" id="time" align='center'>
            <div class="radio">
              <label>
                <input type="radio" name="time" id="time" value=0 {{t1}}> {{s1}}
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name="time" id="time" value=1 {{t2}}> {{s2}}
              </label>
            </div>
            <hr>
            <button type="submit" class="btn btn-default">Submit</button>
          </form>
        {% elif status == 4 %}
          <h4 align='center'>time: {{cur_time}} <h4>
          <h4 align='center'>starting in {{eta}} later ...</h4>
          <meta http-equiv="refresh" content="{{fresh}}">
        {% elif status == 5 %}
          <meta http-equiv="refresh" content="{{fresh}}">
        {% elif status == 6 %}
          <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
          <p align=center><a href={{wechat}}>从微信打开</a></p>
          <script src="http://payment.ucas.ac.cn/NetWorkUI/lib/jQuery 1.11.1.js" type="text/javascript"></script>
          <script language="javascript" type="text/javascript" src="http://payment.ucas.ac.cn/NetWorkUI/js/jquery.qrcode.min.js"></script>
          <script type="text/javascript">
            $(function(){
              $("#code").empty();
              var msgCode = 'SUCCESS';
              var weixinMessage = '??';
              var urlCode = toUtf8('{{wechat}}');
              if(msgCode == "SUCCESS" && null != urlCode && "" != urlCode){
                $("#code").qrcode({
                  //render:($.browser.msie && $.browser.version < 9 ? "table" : "canvas"),
                  render:"table",
                  width: 260,
                  height:260,
                  text: urlCode
                });
              }else{
                $("#successDIV").css("display","none");
                $("#errorMessage").html(weixinMessage);
                $("#errorDiv").css("display","block");
              }

              //var str = toUtf8('??');

            })

            function toUtf8(str) {
              var out, i, len, c;
              out = "";
              len = str.length;
              for(i = 0; i < len; i++) {
                c = str.charCodeAt(i);
                if ((c >= 0x0001) && (c <= 0x007F)) {
                  out += str.charAt(i);
                } else if (c > 0x07FF) {
                  out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));
                  out += String.fromCharCode(0x80 | ((c >>  6) & 0x3F));
                  out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));
                } else {
                  out += String.fromCharCode(0xC0 | ((c >>  6) & 0x1F));
                  out += String.fromCharCode(0x80 | ((c >>  0) & 0x3F));
                }
              }
              return out;
            }
          </script>

          <!--主体 begin-->
          <div class="row">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div id="code" ></div>
            </div>
            <div class="col-md-4"></div>
          </div>
          <!--主体 end-->

        {% endif %}
        </div>
      </div>
      {% if msg %}
        {% for each in msg %}
          {% if each[:5] == '[SUC]' %}
            <div class="alert alert-success" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
          {% elif each[:5] == '[WRN]' %}
            <div class="alert alert-warning" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
          {% elif each[:5] == '[ERR]' %}
            <div class="alert alert-danger" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
          {% else %}
            <div class="alert alert-info" role="alert">
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span></button>
          {% endif %}
              <p align='center'> {{each}}</p>
            </div>
        {% endfor %}
      {% endif %}
    </div>
  </body>
</html>
